@if (isloading) {
<div class="loading-overlay">
  <mat-spinner diameter="50"></mat-spinner>
</div>
} @if (!isloading) {
<mat-toolbar class="menu">
  <button matIconButton class="example-icon" [matMenuTriggerFor]="menu">
    <mat-icon>menu</mat-icon>
  </button>

  <mat-menu #menu="matMenu">
    <a mat-menu-item href="/inicio">
      <mat-icon>house</mat-icon>
      <span>Início</span>
    </a>
    <a mat-menu-item href="/meus-agendamentos">
      <mat-icon>event_available</mat-icon>
      <span>Meus Agendamentos</span>
    </a>
    <button mat-menu-item>
      <mat-icon>badge</mat-icon>
      <span>Meus Dados</span>
    </button>
    @if (user.type === 'administrator') {
    <a mat-menu-item href="/admin">
      <mat-icon>admin_panel_settings</mat-icon>
      <span>Administrador</span>
    </a>
    }
    <a mat-menu-item href="https://www.verao.pr.gov.br/" target="_blank">
      <mat-icon>beach_access</mat-icon>
      <span>Verão Maior 2026</span>
    </a>
  </mat-menu>

  <span id="logo">
    <img src="images/verao-maior-menu.png" style="width: 220px" />
  </span>
  <span class="example-spacer"></span>

  <button matIconButton class="example-icon" [matMenuTriggerFor]="userMenu">
    <mat-icon>account_circle</mat-icon>
  </button>

  <mat-menu #userMenu="matMenu">
    <button mat-menu-item>
      <mat-icon class="material-icons-outlined">account_circle</mat-icon>
      <span>{{ user.name }}</span>
    </button>
    <button mat-menu-item (click)="logout()">
      <mat-icon>exit_to_app</mat-icon>
      <span>SAIR</span>
    </button>
  </mat-menu>
</mat-toolbar>

<div class="admin-container">
  <br />
  <mat-card class="alert-card mat-elevation-z2">
  <mat-card-content>
    <div class="alert-container">
      <div class="alert-icon-wrapper">
        <mat-icon color="warn">screen_rotation</mat-icon>
      </div>
      <div class="alert-content">
        <h3>Gire a tela para visualizar a tabela</h3>
      </div>
    </div>
  </mat-card-content>
</mat-card>
  <br />
  <mat-form-field appearance="outline" style="width: 300px; margin: 0px auto; margin-left: 30px;">
    <mat-label>Filtrar Agendamentos</mat-label>
    <input matInput (keyup)="applyFilter($event)" placeholder="Buscar por nome ou atividade" />
    <mat-icon matSuffix>search</mat-icon>
  </mat-form-field>

  <div class="table-container mat-elevation-z8">
    <table mat-table [dataSource]="dataSource()">
      <ng-container matColumnDef="nome">
        <th mat-header-cell *matHeaderCellDef>Nome</th>
        <td mat-cell *matCellDef="let s" data-label="Pessoa">{{ s.name }}</td>
      </ng-container>

      <ng-container matColumnDef="atividade">
        <th mat-header-cell *matHeaderCellDef>Atividade</th>
        <td mat-cell *matCellDef="let s" data-label="Atiividade">{{ s.resourceName }}</td>
      </ng-container>

      <ng-container matColumnDef="horario">
        <th mat-header-cell *matHeaderCellDef>Horário</th>
        <td mat-cell *matCellDef="let s" data-label="Horário">
          {{ s.horario | date : 'dd/MM/yyyy HH:mm' : 'UTC' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="acao">
        <th mat-header-cell *matHeaderCellDef>Ações</th>
        <td mat-cell *matCellDef="let s">
          <button
            matButton="filled"
            color="warn"
            (click)="openDialog(s)"
            matTooltip="Cancelar agendamento de {{ s.name }}"
          >
            <mat-icon>delete_forever</mat-icon>
            Cancelar
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="3" style="padding: 20px; text-align: center">
          Nenhum agendamento ativo encontrado.
        </td>
      </tr>
    </table>
  </div>
</div>
}
